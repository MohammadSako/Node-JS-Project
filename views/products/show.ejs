<% layout('layouts/boilerplate') %> 
<link rel="stylesheet" href="/stylesheet/stars.css">

<div class="container">
    <div class="row">
        <div class="col-xxl-3 col-xl-3 col-lg-6 mt-3">
            <div class="card shadow p-3  bg-body rounded">
                <div class="card-body">
                    <h5 class="card-title">Category</h5>
                    <h6 class="card-subtitle mb-2"><%= product.category %> </h6>
                    <p class="card-text"><%= product.description %></p>
                    <h5 class="card-title">Brands</h5>
                    <a href="" class="removeUnderLine"><p class="card-text"><%= product.brand %></p></a>
                    <h5 class="card-title mt-3">Submitted by:</h5>
                    <a href="" class="removeUnderLine"><p class="card-text"><em><%=product.author.username%></em></p></a>
                </div>
            </div>
        </div>
        <div class="col-xxl-4 col-xl-5 col-lg-6 mt-3">
            <div class="card shadow p-3  bg-body rounded">
                <div id="carouselExampleControls" class="carousel slide" data-bs-ride="carousel">
                    <div class="carousel-inner">
                        <% product.images.forEach((img, i) => {%>
                            <div class="carousel-item <%= i === 0 ? 'active' : '' %> ">
                                <img src="<%= img.url %>" class="d-block w-100" alt="...">
                            </div>
                        <% }) %>
                    </div>
                    <% if (product.images.length > 1) {%> 
                    <button class="carousel-control-prev" type="button" data-bs-target="#carouselExampleControls" data-bs-slide="prev">
                        <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                        <span class="visually-hidden">Previous</span>
                    </button>
                    <button class="carousel-control-next" type="button" data-bs-target="#carouselExampleControls" data-bs-slide="next">
                        <span class="carousel-control-next-icon" aria-hidden="true"></span>
                        <span class="visually-hidden">Next</span>
                    </button>
                    <% } %> 
                </div>
    
                <div class="card-body">
                    <h5 class="card-title"><span style="color: red;"><%= product.name %></span></h5>
                </div>
                <ul class="list-group list-group-flush">
                    <li class="list-group-item"><%= product.category%></li>
                    <li class="list-group-item"><span style="color: red;"><%= product.price %> </span>JD, <i> per</i> <span style="color: red;"><%= product.weight %></span><i> g</i></li>
                </ul>
            </div>
        </div>
        <div class="col-xxl-4 col-xl-4 col-lg-12 mt-3">
            <div class="card shadow p-2 mb-3 bg-body rounded">
                <div class="card-body">
                    <h4><%= product.brand %></h4>
                    <hr>
                    <h5 class="card-title"><span style="color: red;"><%= product.name %></h5>
                    <p>
                        <h4><%= product.price %> JD</h4> <h6>Per: <span style="color: red;"><%= product.weight %></span><i> g</i></h6>
                    </p>
                    <p class="starability-result" data-rating="<%=product.rating %>">
                        Rated: <%=product.rating%>  
                    </p> 
                    <a href="/add-to-cart/<%= product._id %>"><button class="btn btn-success">Add to cart</button></a>

                </div>
            </div>
            <% if (currentUser && product.author.equals(currentUser._id)) { %> 
            <div class="row mb-3">
                <div class="col-6">
                    <div class="d-grid gap-2">
                        <a href="/products/<%=product._id%>/edit " class="btn btn-info">Edit</a>
                    </div>
                </div>
                <div class="col-6">
                    <form action="/products/<%=product._id%>?_method=DELETE" method="POST" class="d-grid gap-2">
                        <button class="btn btn-danger">Delete</button>
                    </form>
                </div>
            </div>
            <% } %> 
        </div>
    </div>
    <figure>
        <blockquote class="blockquote">
            <p><%= product.name %></p>
        </blockquote>
        <figcaption class="blockquote-footer">
            <%= product.brand %>
        </figcaption>
    </figure>
<!-- buttons -->
    <div class="row">
        <div class="col-xxl-3 col-xl-3 col-lg-3 col-xs-12">
            <div class="row">
                <div class="d-grid gap-2">
                    <a href="/products" class="btn btn-primary btn-lg">Back to Products</a>
                </div>
            </div>
        </div>
    </div>

    <!-- Write A Review -->
    <div class="text-success">
    <hr>
    </div>
    <div>
        <h4 class="mb-5">Ratings and Reviews</h4>
        <% if(currentUser){%> 
            <form action="/products/<%=product._id%>/reviews" method="POST" class="mb-3 validated-form" novalidate>
                <div>
                    <fieldset class="starability-basic">
                        <input type="radio" id="no-rate" class="input-no-rate" name="review[rating]" value="1" checked aria-label="No rating." />
                        <input type="radio" id="first-rate1" name="review[rating]" value="1" />
                        <label for="first-rate1" title="Terrible">1 star</label>
                        <input type="radio" id="first-rate2" name="review[rating]" value="2" />
                        <label for="first-rate2" title="Not good">2 stars</label>
                        <input type="radio" id="first-rate3" name="review[rating]" value="3" />
                        <label for="first-rate3" title="Average">3 stars</label>
                        <input type="radio" id="first-rate4" name="review[rating]" value="4" />
                        <label for="first-rate4" title="Very good">4 stars</label>
                        <input type="radio" id="first-rate5" name="review[rating]" value="5" />
                        <label for="first-rate5" title="Amazing">5 stars</label>
                    </fieldset>
                </div>
                <div class="mb-3">
                    <label class="form-label" for="body">Review</label>
                    <textarea class="form-control" name="review[body]" id="body" cols="30" rows="4" required></textarea>
                </div>
                <button class="btn btn-success mb-3">Submit</button>
            </form>
        </div>
        <% } else { %>
            <a href="/login"><h5 style="margin-bottom: 20px;"><i>Login to Rate & Review</i></h5></a>    
        <% } %> 

            <!-- Displaying Reviews -->
        <%for(let review of product.reviews) {%> 
            <div class="card mb-5">
                <div class="card-body">
                    <p class="starability-result" data-rating="<%=review.rating %>">
                        Rated: <%=review.rating%>  
                    </p>                    
                    <h6 class="card-subtitle mb-2 text-muted"><em>By: <%= review.author.username %></em></h6>
                    <p class="card-text text-muted">Review: <%= review.body%></p>
                    
                    <% if(currentUser && review.author.equals(currentUser._id)) {%> 
                    <form action="/products/<%=product._id%>/reviews/<%=review._id%>?_method=DELETE" method="POST">
                        <button class="btn btn-sm btn-danger">Delete</button>
                    </form>
                    <% } %> 
                </div>
            </div> 
        <%}%>

    
    <div class="text-success">
        <hr>
    </div>
    <div>
        <p class="lead text-muted"><strong>About the Product</strong></p>
        <p class="text-muted"><em>Fresho brings to you an exquisite range of locally grown organic tomatoes, which are now available at bigbasket. These organic tomatoes are free from harmful pesticides and insecticides and thus have a very natural and tangy taste, which is attributed to its healthy soil growth. The ripe and firm tomatoes are a luscious addition to any meal.</em></p>
    </div>
    <div class="text-success">
        <hr>
    </div>
    <div>
        <p class="lead text-muted"><strong>Benefits</strong></p>
        <p class="text-muted"><em>Organic tomatoes are free from harmful chemicals and toxins, plus they are also rich in antioxidants that helps fight diseases like cancer. It also a healthy source of Vitamin C and A (being rich in beta-carotene) along with niacin and folate.</em></p>
    </div>
    <div class="text-success">
        <hr>
    </div>
    <div>
        <p class="lead text-muted"><strong>How to Use</strong></p>
        <p class="text-muted"><em>Tomatoes can be sliced up and used in salads or eaten on their own. You can boil and puree them for pasta sauces, stews, soups or even Pizza (works well with herbs like basil). You can scoop their interiors and stuff it veggies or meat to make stuffed tomatoes and bake them in the oven.</em></p>
    </div>
    <div class="text-success">
        <hr>
    </div>
    <div>
        <p class="lead text-muted"><strong>Variable weight policy</strong></p>
        <p class="text-muted"><em>Please note that the item(s) in this product may vary slightly in size and weight. Hence, the actual weight of the product delivered can have a small variance. You will be billed based on the actual weight during order processing.</em></p>
    </div>
    <div class="text-success">
        <hr>
    </div>

    <h5>Frequently Bought</h5>
    <div class="row">
        <% for( let product of products) {%>
            <div class="col-xxl-3 col-xl-4 col-lg-6 col-md-6 col-xs-12 mb-3 mt-3"><a href="<%= product._id %> " class="removeUnderLine">
                <div class="card shadow p-3 mb-3 bg-body rounded" style="width: 18rem;">
                    <img src="<%= product.images[0].url %>" style="height: 200px;" class="card-img-top" alt="...">
                    <div class="card-body">
                        <h5 class="card-title"><%= product.name %></h5>
                        <p class="card-text muted-text" style="color:#ff7575;"><%= product.brand %></p>
                    </div>
                    <ul class="list-group list-group-flush mb-3">
                        <li class="list-group-item"><%= product.category%></li>
                        <li class="list-group-item"><%= product.price %>$ Per <%= product.weight %>g</li>
                        <li class="list-group-item starability-result mt-3 mx-auto" data-rating="<%=product.rating %>">Rating: <%= product.rating %></li>
                    </ul>
                    
                    <a href="/add-to-cart/<%= product._id %>" class="btn btn-primary" ><svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" fill="currentColor" class="bi bi-cart3" viewBox="0 0 16 16">
                        <path d="M0 1.5A.5.5 0 0 1 .5 1H2a.5.5 0 0 1 .485.379L2.89 3H14.5a.5.5 0 0 1 .49.598l-1 5a.5.5 0 0 1-.465.401l-9.397.472L4.415 11H13a.5.5 0 0 1 0 1H4a.5.5 0 0 1-.491-.408L2.01 3.607 1.61 2H.5a.5.5 0 0 1-.5-.5zM3.102 4l.84 4.479 9.144-.459L13.89 4H3.102zM5 12a2 2 0 1 0 0 4 2 2 0 0 0 0-4zm7 0a2 2 0 1 0 0 4 2 2 0 0 0 0-4zm-7 1a1 1 0 1 1 0 2 1 1 0 0 1 0-2zm7 0a1 1 0 1 1 0 2 1 1 0 0 1 0-2z"/>
                    </svg></a>
                </div></a>
            </div>
        <%}%>
    </div>

</div>
