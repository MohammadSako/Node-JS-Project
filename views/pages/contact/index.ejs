<% layout('layouts/boilerplate') %> 
<div class="container">
    <div class="row">
        <div class="col-12 mb-3">
            <div>
                <h5 class="text-muted"><strong>Contact Us</strong></h5>
                <p class="text-muted"><em>To reach our customer service team please email us at: <a href="#" style="text-decoration: none;">customerservice@ShoppingMarket.com</a></em></p>
            </div>
            <div id="cluster-map"></div>

            <div class="accordion mt-3" id="accordionExample">
                <% for( let contact of contacts) {%>
                <div class="accordion-item">
                    <h2 class="accordion-header" id="heading<%= contact._id %>">
                        <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapse<%= contact._id %>" aria-expanded="true" aria-controls="collapse<%= contact._id %>">
                            <%= contact.country %>
                        </button>
                    </h2>
                    <div id="collapse<%= contact._id %>" class="accordion-collapse collapse" aria-labelledby="heading<%= contact._id %>" data-bs-parent="#accordionExample">
                        <div class="accordion-body">
                            <div class="row">
                                <div class="col-xxl-6 col-xl-6 col-l-6 col-md-6">
                                    <ul>
                                        <li><span>City:</span> <%= contact.city %></li>
                                        <li><span>State:</span> <%= contact.state %></li>
                                        <li><span>Street:</span> <%= contact.street %></li>
                                    </ul>
                                </div>
                                <div class="col-xxl-6 col-xl-6 col-l-6 col-md-6"> 
                                    <ul>
                                        <li><span>Building No:</span> <%= contact.building %></li>
                                        <li><span>Zip Code:</span> <%= contact.zip %></li>
                                        <li><span>Tel:</span> <%= contact.tel %></li>
                                    </ul>
                                </div>
                            </div>
                            <% if(currentUser) {%>
                            <a href="/contact/<%=contact._id%>/edit"><button class="btn btn-info mt-3">Edit the Contact</button></a>
                            <form class="mt-3" action="/contact/<%=contact._id%>?_method=DELETE" method="POST">
                                <button class="btn btn-danger">Delete</button>
                            </form>
                            <% } %>
                        </div>
                    </div>
                </div>
                <%}%> 
            </div>
            <% if(currentUser) {%> 
                <a href="/contact/new"><button class="btn btn-success mt-3">Add A New Contact</button></a>
                <% } else { %>
                <h5 class="mt-2"><a href="/login"><em>Login to Create or Edit Contact</em></a></h5>    
            <% } %> 
        </div>
    </div>
</div>
<script>
    const mapToken = '<%-process.env.MAPBOX_TOKEN%>';
    const contacts = {features: <%- JSON.stringify(contacts) %>}
</script>
<script src="/javascript/clusterMap.js"></script>

